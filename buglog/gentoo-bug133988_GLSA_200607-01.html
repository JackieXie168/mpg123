<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <title>Bug 133988 - media-sound/mpg123-0.59s-r9 heap overflow</title>


<link rel="Top" href="http://bugs.gentoo.org/">

  


  
    <link rel="Show" title="Dependency Tree"
          href="showdependencytree.cgi?id=133988">
    <link rel="Show" title="Dependency Graph"
          href="showdependencygraph.cgi?id=133988">


      <link rel="Show" title="Bug Activity"
            href="show_activity.cgi?id=133988">
      <link rel="Show" title="Printer-Friendly Version"
            href="show_bug.cgi?format=multiple&amp;id=133988">

    

    <script type="text/javascript">
  <!--
  
  function initHelp() {}
  // -->
  </script>

    <link href="skins/standard/global.css" rel="stylesheet" type="text/css">
    <link href="skins/custom/global.css" rel="stylesheet" type="text/css">



    


  </head>



  <body onload=""
        class="bugs-gentoo-org bz_bug bz_status_RESOLVED bz_component_Vulnerabilities bz_bug_133988">


<div id="banner">
     <p id="banner-name">
     <center><a href="/"><img border=0 src="/skins/custom/gentoo-header.png"></a></center>
     <!-- <span>This is Bugzilla</span>
      </p>
      <p id="banner-version">
      <br>
        <a href="http://www.bugzilla.org/"><span>Bugzilla</span></a>
        <span>Version 2.20+</span> -->
	<p>
	<a href="http://www.gentoo.org/">Home</a> |
	<a href="http://www.gentoo.org/doc/en/index.xml">Docs</a> |
	<a href="http://forums.gentoo.org/">Forums</a> |
	<a href="http://www.gentoo.org/main/en/lists.xml">Lists</a> |
	<a href="/">Bugs</a> |
	<a href="http://planet.gentoo.org">Planet</a> |
	<a href="http://store.gentoo.org">Store</a> |
	<a href="http://www.gentoo.org/news/en/gwn/gwn.xml">GWN</a> |
	<a href="http://www.gentoo.org/main/en/where.xml">Get Gentoo!</a>
      </p>
    <div class="outro"></div>
    </div>

<div id="header">
    <h1>Bugzilla Bug 133988</h1>

    <h2>media-sound/mpg123-0.59s-r9 heap overflow</h2>

    <h3>Last modified: 2006-07-03 11:35:27 PST</h3>
</div>
<i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">No search results available</font></i>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="query.cgi">Search page</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="enter_bug.cgi">Enter new bug</a>

<hr>
<!-- jsf: add_archs function -->
<script type="text/javascript">
<!--
function add_arches() {
  var i;
  for(i=0;i<document.changeform.addarches.options.length;i++) {
    if(document.changeform.addarches.options[i].selected) {
      if(!document.changeform.newcc.value) {
        document.changeform.newcc.value = document.changeform.addarches.options[i].value;
      } else {
        document.changeform.newcc.value = document.changeform.newcc.value + "," + document.changeform.addarches.options[i].value      }
      // Deselect the item...not necessary
      document.changeform.addarches.options[i].selected = false;
    }
  }
}
-->
</script>




  <script type="text/javascript">
  <!--

  /* Outputs a link to call replyToComment(); used to reduce HTML output */
  function addReplyLink(id) {
    /* XXX this should really be updated to use the DOM Core's
     * createElement, but finding a container isn't trivial */
    document.write('[<a href="#add_comment" onclick="replyToComment(' + 
        id + ');">reply<' + '/a>]');
  }

  /* Adds the reply text to the `comment' textarea */
  function replyToComment(id) {
    /* pre id="comment_name_N" */
    var text_elem = document.getElementById('comment_text_'+id);
    var text = getText(text_elem);

    /* make sure we split on all newlines -- IE or Moz use \r and \n
     * respectively */
    text = text.split(/\r|\n/);

    var replytext = "";
    for (var i=0; i < text.length; i++) {
        replytext += "> " + text[i] + "\n"; 
    }

    replytext = "(In reply to comment #" + id + ")\n" + replytext + "\n";


    /* <textarea id="comment"> */
    var textarea = document.getElementById('comment');
    textarea.value += replytext;

    textarea.focus();
  }

  if (!Node) {
    /* MSIE doesn't define Node, so provide a compatibility array */
    var Node = {
        TEXT_NODE: 3,
        ENTITY_REFERENCE_NODE: 5
    };
  }

  /* Concatenates all text from element's childNodes. This is used
   * instead of innerHTML because we want the actual text (and
   * innerText is non-standard) */
  function getText(element) {
    var child, text = "";
    for (var i=0; i < element.childNodes.length; i++) {
        child = element.childNodes[i];
        var type = child.nodeType;
        if (type == Node.TEXT_NODE || type == Node.ENTITY_REFERENCE_NODE) {
            text += child.nodeValue;
        } else {
            /* recurse into nodes of other types */
            text += getText(child);
        }
    }
    return text;
  }


  //-->
  </script>

<form name="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2006-07-03 11:35:27">
  <input type="hidden" name="longdesclength" value="21">
  <input type="hidden" name="id" value="133988">



  <table>

    <tr>
      <td valign="top">
        <table cellspacing="1" cellpadding="1">
  
          <tr>
            <td align="right">
              <b>Bug#:</b>
            </td>
            <td>
              <a href="http://bugs.gentoo.org/show_bug.cgi?id=133988">133988</a>
                  <label for="alias" title="a name for the bug that can be used in place of its ID number, f.e. when adding it to a list of dependencies">
                    <b>alias:</b>
                    <input id="alias" name="alias" value="" size="20" maxlength="20">
                  </label>
            </td>
          </tr>

          <tr>
            <td align="right">
              <b><u>P</u>roduct:</b>
            </td><td>
    <label for="product" accesskey="p">
      <select name="product" id="product">
          <option value="Admin">Admin
          </option>
          <option value="Bugzilla">Bugzilla
          </option>
          <option value="Developer Relations">Developer Relations
          </option>
          <option value="Doc Other">Doc Other
          </option>
          <option value="Doc Translations">Doc Translations
          </option>
          <option value="Documentation">Documentation
          </option>
          <option value="Gentoo Hosted Projects">Gentoo Hosted Projects
          </option>
          <option value="Gentoo Infrastructure">Gentoo Infrastructure
          </option>
          <option value="Gentoo Linux">Gentoo Linux
          </option>
          <option value="Gentoo Release Media">Gentoo Release Media
          </option>
          <option value="Gentoo Security" selected>Gentoo Security
          </option>
          <option value="Gentoo/Alt">Gentoo/Alt
          </option>
          <option value="Mirrors">Mirrors
          </option>
          <option value="Portage Development">Portage Development
          </option>
          <option value="Recruitment">Recruitment
          </option>
          <option value="Website www.gentoo.org">Website www.gentoo.org
          </option>
      </select>
    </label>
  </td>
  <td>&nbsp;</td>
          </tr>

          

          <tr>
            <td align="right">
              <b>
                <a href="describecomponents.cgi?product=Gentoo%20Security">
                  Co<u>m</u>ponent</a>:
              </b>
            </td><td>
    <label for="component" accesskey="m">
      <select name="component" id="component">
          <option value="Auditing">Auditing
          </option>
          <option value="Default Configs">Default Configs
          </option>
          <option value="GLSA Errors">GLSA Errors
          </option>
          <option value="Kernel">Kernel
          </option>
          <option value="Runpath Issues">Runpath Issues
          </option>
          <option value="Vulnerabilities" selected>Vulnerabilities
          </option>
      </select>
    </label>
  </td>
  <td>&nbsp;</td>
          </tr>

          <tr>
            <td align="right">
              <b>
                <a href="page.cgi?id=fields.html#status">Status</a>:
              </b>
            </td>
            <td>RESOLVED</td>
          </tr>

          <tr>
            <td align="right">
              <b>
                <a href="page.cgi?id=fields.html#resolution">Resolution</a>:
              </b>
            </td>
            <td>FIXED
            </td>
          </tr>

          <tr>
            <td align="right">
              <b>
                <a href="page.cgi?id=fields.html#assigned_to">Assigned&nbsp;To</a>:
              </b>
            </td>
            <td>Gentoo Security &lt;security&#64;gentoo.org&gt;</td>
          </tr>

        </table>

      </td>
      <td valign="top">

        <table cellspacing="1" cellpadding="1">

          <tr>
            <td align="right">
              <b><u>H</u>ardware:</b>
            </td><td>
    <label for="rep_platform" accesskey="h">
      <select name="rep_platform" id="rep_platform">
          <option value="All">All
          </option>
          <option value="Other">Other
          </option>
          <option value="AMD64">AMD64
          </option>
          <option value="x86" selected>x86
          </option>
          <option value="Alpha">Alpha
          </option>
          <option value="Sparc">Sparc
          </option>
          <option value="IA64">IA64
          </option>
          <option value="PPC">PPC
          </option>
          <option value="MIPS">MIPS
          </option>
          <option value="PPC64">PPC64
          </option>
          <option value="HPPA">HPPA
          </option>
          <option value="s390">s390
          </option>
          <option value="sh">sh
          </option>
          <option value="Sparc64">Sparc64
          </option>
          <option value="ARM">ARM
          </option>
      </select>
    </label>
  </td>
  <td>&nbsp;</td>
          </tr>

          <tr>
            <td align="right">
              <b><u>O</u>S:</b>
            </td><td>
    <label for="op_sys" accesskey="o">
      <select name="op_sys" id="op_sys">
          <option value="Other">Other
          </option>
          <option value="Linux" selected>Linux
          </option>
          <option value="All">All
          </option>
          <option value="FreeBSD">FreeBSD
          </option>
          <option value="OS X">OS X
          </option>
          <option value="GNU/kFreeBSD">GNU/kFreeBSD
          </option>
          <option value="NetBSD">NetBSD
          </option>
          <option value="OpenBSD">OpenBSD
          </option>
          <option value="DragonFly">DragonFly
          </option>
      </select>
    </label>
  </td>
  <td>&nbsp;</td>
          </tr>

          <tr>
            <td align="right">
              <b><u>V</u>ersion:</b>
            </td><td>
    <label for="version" accesskey="v">
      <select name="version" id="version">
          <option value="unspecified" selected>unspecified
          </option>
      </select>
    </label>
  </td>
  <td>&nbsp;</td>
          </tr>

          <tr>
            <td align="right">
              <b><a href="page.cgi?id=fields.html#priority">Pr<u>i</u>ority</a>:</b>
            </td><td>
    <label for="priority" accesskey="i">
      <select name="priority" id="priority">
          <option value="P1">P1
          </option>
          <option value="P2" selected>P2
          </option>
          <option value="P3">P3
          </option>
          <option value="P4">P4
          </option>
          <option value="P5">P5
          </option>
      </select>
    </label>
  </td>
  <td>&nbsp;</td>
          </tr>

          <tr>
            <td align="right">
              <b><a href="page.cgi?id=fields.html#bug_severity">S<u>e</u>verity</a>:</b>
            </td><td>
    <label for="bug_severity" accesskey="e">
      <select name="bug_severity" id="bug_severity">
          <option value="blocker">blocker
          </option>
          <option value="critical">critical
          </option>
          <option value="major">major
          </option>
          <option value="normal" selected>normal
          </option>
          <option value="minor">minor
          </option>
          <option value="trivial">trivial
          </option>
          <option value="enhancement">enhancement
          </option>
      </select>
    </label>
  </td>
  <td>&nbsp;</td>
          </tr>


        </table>
      </td>

      <td valign="top">

        <table cellpadding="1" cellspacing="1">

          <tr>
            <td align="right">
              <b>Reporter:</b>
            </td>
            <td>
              <a href="mailto:gentoo&#64;schirmeier.com">Horst Schirmeier &lt;gentoo&#64;schirmeier.com&gt;</a>
            </td>
          </tr>

          <tr>
            <td align="right" valign="top">
              <b><u>A</u>dd&nbsp;CC:</b>
            </td>
            <td><input
  name="newcc"
  value="" accesskey="a"  size="30" 
>
            </td>
          </tr>

<!-- jsf: add archs -->
          <tr>
            <td align="right" valign="top">
              <b>CC:</b>
            </td>
            <td valign="top">
              <select name="cc" multiple="multiple" size="5">
                <option value="eradicator&#64;gentoo.org">eradicator&#64;gentoo.org</option>
                <option value="ia64&#64;gentoo.org">ia64&#64;gentoo.org</option>
                <option value="mips&#64;gentoo.org">mips&#64;gentoo.org</option>
                <option value="tcort&#64;gentoo.org">tcort&#64;gentoo.org</option>
              </select>
              <br>
              <input type="checkbox" name="removecc">Remove selected CCs
              <br>
            </td>
          </tr>

        </table>

      </td>
      </tr>

      <tr>
        <td colspan="2">
          <table cellspacing="1" cellpadding="1">

      


          <tr>
            <td align="right">
              <b>
                  <u>U</u>RL:
              </b>
            </td>
            <td colspan="5">
              <input name="bug_file_loc" accesskey="u"
                     value="" size="60">
            </td>
          </tr>

          <tr>
            <td align="right">
              <b><u>S</u>ummary:</b>
            </td>
            <td colspan="5">
              <input name="short_desc" accesskey="s"
                     value="media-sound/mpg123-0.59s-r9 heap overflow" size="60">
            </td>
          </tr>

            <tr>
              <td align="right">
                <b>Status <u>W</u>hiteboard:</b>
              </td>
              <td colspan="5">
                <input name="status_whiteboard" accesskey="w"
                       value="B2 [glsa] DerCorny" size="60">
              </td>
            </tr>

            <tr>
              <td align="right">
                <b>
                  <a href="describekeywords.cgi"><u>K</u>eywords</a>:
                </b>
              <td colspan="5">
                <input name="keywords" accesskey="k"
                       value="" size="60">
              </td>
            </tr>

        </table>
      </td>

      <td valign="top">
        <table cellspacing="1" cellpadding="1">
          <tr>
            <td colspan="2" valign="top"><script type="text/javascript">
<!-- 
  var stored_onload = window.onload;
  // Enables or disables a requestee field depending on whether or not
  // the user is requesting the corresponding flag.
  function toggleRequesteeField(flagField)
  {
    // Convert the ID of the flag field into the ID of its corresponding
    // requestee field and then use the ID to get the field.
    var id = flagField.name.replace(/flag(_type)?-(\d+)/, "requestee$1-$2");
    var requesteeField = document.getElementById(id);
    if (!requesteeField) return;
    
    // Enable or disable the requestee field based on the value
    // of the flag field.
    if (flagField.value == "?") {
        requesteeField.disabled = false;
        requesteeField.focus();
    } else                         
        requesteeField.disabled = true;
  }
  
  // Disables requestee fields when the window is loaded since they shouldn't
  // be enabled until the user requests that flag type.
  function disableRequesteeFields()
  {
    var inputElements = document.getElementsByTagName("input");
    var inputElement, id, flagField;
    for ( var i=0 ; i<inputElements.length ; i++ )
    {
      inputElement = inputElements.item(i);
      if (inputElement.name.search(/^requestee(_type)?-(\d+)$/) != -1)
      {
        // Convert the ID of the requestee field into the ID of its corresponding
        // flag field and then use the ID to get the field.
        id = inputElement.name.replace(/requestee(_type)?-(\d+)/, "flag$1-$2");
        flagField = document.getElementById(id);
        if (flagField && flagField.value != "?")
            inputElement.disabled = true;
      }
    }
    if (stored_onload) {
        stored_onload();
    }
  }
  window.onload = disableRequesteeFields;
// -->
</script>



<table id="flags">
  <tr>
    <th colspan="3">
      Flags:
    </th>
      <th>
        Requestee:
      </th>
  </tr>

  
    
    
    
    
      <tr>
        <td>&nbsp;</td>
        <td>Pending</td>
        <td>
          <select id="flag_type-2" name="flag_type-2" 
                  onchange="toggleRequesteeField(this);">
            <option value="X"></option>
            <option value="+">+</option>
            <option value="-">-</option>
          </select>
        </td>
          <td>
          </td>
      </tr>
    
    
    
    
      <tr>
        <td>&nbsp;</td>
        <td>Approved</td>
        <td>
          <select id="flag_type-1" name="flag_type-1" 
                  onchange="toggleRequesteeField(this);">
            <option value="X"></option>
            <option value="+">+</option>
            <option value="-">-</option>
          </select>
        </td>
          <td>
          </td>
      </tr>
    
    
    
    
      <tr>
        <td>&nbsp;</td>
        <td>Assigned_To</td>
        <td>
          <select id="flag_type-3" name="flag_type-3" 
                  onchange="toggleRequesteeField(this);">
            <option value="X"></option>
            <option value="+">+</option>
            <option value="-">-</option>
              <option value="?">?</option>
          </select>
        </td>
          <td>
              <span style="white-space: nowrap;">
                (<input type="text" size="8" maxlength="255"
                        id="requestee_type-3" 
                        name="requestee_type-3">)
              </span>
          </td>
      </tr>

  

</table>
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>



<br>
<table cellspacing="0" cellpadding="4" border="1">
  <tr>
    <th bgcolor="#cccccc" align="left">Attachment</th>
    <th bgcolor="#cccccc" align="left">Type</th>
    <th bgcolor="#cccccc" align="left">Created</th>
    <th bgcolor="#cccccc" align="left">Size</th>
    <th bgcolor="#cccccc" align="left">Actions</th>
  </tr>
      <tr >
        <td valign="top">
          <a href="attachment.cgi?id=87220">103_all_CAN-2004-0982-NEW.patch</a>
        </td>

        <td valign="top">
            <i>patch</i>
        </td>

        <td valign="top">2006-05-21 18:02 PST</td>
        <td valign="top">7.17 KB</td>


        <td valign="top">
          <a href="attachment.cgi?id=87220&amp;action=edit">Edit</a>
            | <a href="attachment.cgi?id=87220&amp;action=diff">Diff</a>
        </td>
      </tr>
      <tr >
        <td valign="top">
          <a href="attachment.cgi?id=87221">separate patch on top of 103_all_CAN-2004-0982.patch</a>
        </td>

        <td valign="top">
            <i>patch</i>
        </td>

        <td valign="top">2006-05-21 18:04 PST</td>
        <td valign="top">1.41 KB</td>


        <td valign="top">
          <a href="attachment.cgi?id=87221&amp;action=edit">Edit</a>
            | <a href="attachment.cgi?id=87221&amp;action=diff">Diff</a>
        </td>
      </tr>

  <tr>
    <td colspan="4">
      <a href="attachment.cgi?bugid=133988&amp;action=enter">Create a New Attachment</a> (proposed patch, testcase, etc.)
    </td>
      <td>
        <a href="attachment.cgi?bugid=133988&amp;action=viewall">View All</a>
      </td>
  </tr>
</table>
<br>



  <table>
    <tr><th align="right">Bug 133988 <u>d</u>epends on:</th>
  <td>
  </td>
  <td>
    <input name="dependson" accesskey="d"
           value="">
  </td>
      <td rowspan="2">
        <a href="showdependencytree.cgi?id=133988">Show
        dependency tree</a>

          <br>
          <a href="showdependencygraph.cgi?id=133988">Show
          dependency graph</a>
      </td>
    </tr>

    <tr><th align="right">Bug 133988 <u>b</u>locks:</th>
  <td>
  </td>
  <td>
    <input name="blocked" accesskey="b"
           value="">
  </td>
    </tr>
  </table>




  <br>
  <b>Additional <u>C</u>omments: </b> <i>(this is where you put 'emerge --info')</i>
  <br>
  <i>If your emerge --info is too long, please create an attachment containing it.</i>
  <br>
  <a name="add_comment"></a>
  <textarea name="comment" id="comment" rows="10" cols="80"
            accesskey="c"></textarea>

    <br>
    <label for="addselfcc">
      <input type="checkbox" id="addselfcc" name="addselfcc">
      Add  to CC list
    </label>
  <br>

<br>
  <input type="radio" id="knob-leave" name="knob" value="none" checked="checked">
  <label for="knob-leave">
    Leave as <b>RESOLVED&nbsp;FIXED</b>
  </label>
  <br>




        <input type="radio" id="knob-reopen" name="knob" value="reopen">
        <label for="knob-reopen">
          Reopen bug
        </label>
        <br>
        <input type="radio" id="knob-verify" name="knob" value="verify">
        <label for="knob-verify">
          Mark bug as <b>VERIFIED</b>
        </label>
        <br>
        <input type="radio" id="knob-close" name="knob" value="close">
        <label for="knob-close">
          Mark bug as <b>CLOSED</b>
        </label>
        <br>

  <input type="submit" value="Commit">
  <input type="hidden" name="form_name" value="process_bug">
  <p>
    <font size="+1">
      <b>
        <a href="show_activity.cgi?id=133988">View Bug Activity</a>
        &nbsp; | &nbsp;
        <a href="show_bug.cgi?format=multiple&amp;id=133988">Format For Printing</a>
        &nbsp; | &nbsp;
        <a href="enter_bug.cgi?cloned_bug_id=133988">Clone This Bug</a>

        
      </b>
    </font>

  </p>



<hr>
<div >
        <table>
          <tr>
            <td align="left">
              <b><a name="c0" href="#c0">Description</a>:</b>&nbsp;&nbsp;<script 
                type="text/javascript"><!-- 
                  addReplyLink(0);
                //--></script>
            </td>
            <td align="left" width="30%">
              <b>Opened:</b> 2006-05-21 18:01 PST
            </td>
          </tr>
        </table>
        


<pre id="comment_text_0">When running mpg123 with a HTTP URL which sends _any_ HTTP redirection, mpg123
crashes:

$ mpg123 '<a href="http://patrimonium.amberfisharts.com/download.asp?lang=de&amp;id=20">http://patrimonium.amberfisharts.com/download.asp?lang=de&amp;id=20</a>'      
High Performance MPEG 1.0/2.0/2.5 Audio Player for Layer 1, 2 and 3.
Version 0.59s-r9 (2000/Oct/27). Written and copyrights by Michael Hipp.
Uses code from various people. See 'README' for more!
THIS SOFTWARE COMES WITH ABSOLUTELY NO WARRANTY! USE AT YOUR OWN RISK!
*** glibc detected *** free(): invalid pointer: 0x0808d1e8 ***
Aborted

This server sends (among others) a &quot;Location:
downloads/Matthias%20Sachal%20-%20Patrimonium%20Theme.mp3&quot; header, which leads
to an overflow in a heap allocated array.

This bug is caused by a Gentoo specific mpg123 patch
(103_all_CAN-2004-0982.patch), written Jeremy Huddleston
(<a href="mailto:eradicator@gentoo.org">eradicator@gentoo.org</a>), and introduces a possible remote exploitability, which
is why I am making this bug Gentoo Dev and Security only.

--------------------------------------------
Details:
--------------------------------------------
In httpget.c:279 (after applying 103_all_CAN-2004-0982.patch), char *purl gets
assigned some heap-allocated memory, which the patch author thought to have an
upper size limit:

/* The length of purl is upper bound by 3*strlen(url) + 1 if everything in it
is a space */
purl = (char *)malloc(sizeof(char) * (strlen(url)*3 + 1));

Without the patch, this would be malloc(1024), regardless of the URL length.

In the HTTP redirection code, the redirection target is being copied into this
memory area (httpget.c:483):

strncpy (purl, request+10, 1023);

Note that here the assumption is being made that the destination is (at least)
1023 bytes in size (and, additionally, the '\0' termination was not taken care
of in case the redirection URL is &gt;=1023 bytes long). The program crashes when
free()ing the &quot;request&quot; array which comes right &quot;above&quot; &quot;purl&quot; on the heap
(httpget.c:486).

(gdb) p request
$4 = 0x80811e8 &quot;Location:
downloads/Matthias%20Sachal%20-%20Patrimonium%20Theme.mp3\r\n&quot;
(gdb) p purl
$5 = 0x80810a0 &quot;&quot;

If purl got assigned a memory area sized &lt;1023 bytes, strncpy() will overwrite
the glibc heap data structure for &quot;request&quot; (which comes after the memory purl
is pointing at on the heap) as it always pads the destination with zeroes.
Additionally, an attacker MIGHT be able to send a well-crafted redirection
header which overwrites this structure in a more sophisticated way, in effect
enabling him to execute arbitrary code.

--------------------------------------------
Fix:
--------------------------------------------
As a quick fix,
* purl should be malloc'd to max(1024, strlen(url)*3 + 1),
* this initial size should be recorded somewhere (similar to &quot;request&quot;'s
&quot;linelength&quot;) and be used in the strncpy() call instead of the hard-coded 1023.
* zero termination: purl[purl_length-1] = 0

Beyond this heap overflow issue, redirection URLs with arbitrary length should
be taken care of.

--------------------------------------------
Notes:
--------------------------------------------
* This fix does NOT make mpg123 play the example URL above, because the
redirection header is malformed (does not supply an absoluteURI as specified in
the HTTP RFC) and mpg123 thinks &quot;downloads&quot; is the new host to connect to.
* This bug might be related to <span class="bz_closed"><a href="show_bug.cgi?id=78228" title="RESOLVED WORKSFORME - mpg123 crashed with *** glibc detected *** free(): invalid pointer: 0x0000000000552180 ***">bug #78228</a></span>.
* I'm using a recent stable x86 Gentoo, in particular sys-libs/glibc-2.3.6-r3.
</pre>
    </div>
  <div >
        <br>
        <span class="bz_comment">
          ------- <i>Comment
          <a name="c1" href="#c1">#1</a> From 
          <a href="mailto:gentoo&#64;schirmeier.com">Horst Schirmeier</a>
          2006-05-21 18:02 PST 
          </i>
          <script type="text/javascript"><!-- 
            addReplyLink(1); //--></script>
          -------
        </span>
        


<pre id="comment_text_1"><span class=""><a href="attachment.cgi?id=87220&amp;action=view" title="103_all_CAN-2004-0982-NEW.patch">Created an attachment (id=87220)</a> <a href="attachment.cgi?id=87220&amp;action=edit" title="103_all_CAN-2004-0982-NEW.patch">[edit]</a></span>
103_all_CAN-2004-0982-NEW.patch

replacement for 103_all_CAN-2004-0982.patch
</pre>
    </div>
  <div >
        <br>
        <span class="bz_comment">
          ------- <i>Comment
          <a name="c2" href="#c2">#2</a> From 
          <a href="mailto:gentoo&#64;schirmeier.com">Horst Schirmeier</a>
          2006-05-21 18:04 PST 
          </i>
          <script type="text/javascript"><!-- 
            addReplyLink(2); //--></script>
          -------
        </span>
        


<pre id="comment_text_2"><span class=""><a href="attachment.cgi?id=87221&amp;action=view" title="separate patch on top of 103_all_CAN-2004-0982.patch">Created an attachment (id=87221)</a> <a href="attachment.cgi?id=87221&amp;action=edit" title="separate patch on top of 103_all_CAN-2004-0982.patch">[edit]</a></span>
separate patch on top of 103_all_CAN-2004-0982.patch

this is what I changed on top of 103_all_CAN-2004-0982.patch
</pre>
    </div>
  <div >
        <br>
        <span class="bz_comment">
          ------- <i>Comment
          <a name="c3" href="#c3">#3</a> From 
          <a href="mailto:gentoo&#64;schirmeier.com">Horst Schirmeier</a>
          2006-05-21 18:19 PST 
          </i>
          <script type="text/javascript"><!-- 
            addReplyLink(3); //--></script>
          -------
        </span>
        


<pre id="comment_text_3">*** <span class="bz_closed"><a href="show_bug.cgi?id=133987" title="RESOLVED DUPLICATE">Bug 133987</a></span> has been marked as a duplicate of this bug. ***
</pre>
    </div>
  <div >
        <br>
        <span class="bz_comment">
          ------- <i>Comment
          <a name="c4" href="#c4">#4</a> From 
          <a href="mailto:dercorny&#64;gentoo.org">Stefan Cornelius</a>
          2006-05-27 01:51 PST 
          </i>
          <script type="text/javascript"><!-- 
            addReplyLink(4); //--></script>
          -------
        </span>
        


<pre id="comment_text_4">eradicator please have a look ...
</pre>
    </div>
  <div >
        <br>
        <span class="bz_comment">
          ------- <i>Comment
          <a name="c5" href="#c5">#5</a> From 
          <a href="mailto:gentoo&#64;schirmeier.com">Horst Schirmeier</a>
          2006-05-27 04:32 PST 
          </i>
          <script type="text/javascript"><!-- 
            addReplyLink(5); //--></script>
          -------
        </span>
        


<pre id="comment_text_5">An easy way to reproduce the overflow:

( echo -ne &quot;HTTP/1.1 302 Found\r\nLocation: &quot;
  echo -ne &quot;<a href="http://fooooooooooooooooooooooooooooooooooooooooooooooooo/\r\n\r\n">http://fooooooooooooooooooooooooooooooooooooooooooooooooo/\r\n\r\n</a>&quot;
)\
| nc -lp 8080 &amp;

mpg123 <a href="http://localhost:8080/">http://localhost:8080/</a>
</pre>
    </div>
  <div >
        <br>
        <span class="bz_comment">
          ------- <i>Comment
          <a name="c6" href="#c6">#6</a> From 
          <a href="mailto:gentoo&#64;schirmeier.com">Horst Schirmeier</a>
          2006-06-06 07:04 PST 
          </i>
          <script type="text/javascript"><!-- 
            addReplyLink(6); //--></script>
          -------
        </span>
        


<pre id="comment_text_6">My report is 16 days old now; eradicator does not seem to be interested at all.
Would anyone else mind to review this report? The problem description is quite
detailed, my patch is trivial, it only needs to be committed.

Gentoo should not be the only distribution out there with (another) possible
mpg123 vulnerability. (This bug was _introduced_ by a Gentoo patch.)
</pre>
    </div>
  <div >
        <br>
        <span class="bz_comment">
          ------- <i>Comment
          <a name="c7" href="#c7">#7</a> From 
          <a href="mailto:eradicator&#64;gentoo.org">Jeremy Huddleston</a>
          2006-06-06 09:18 PST 
          </i>
          <script type="text/javascript"><!-- 
            addReplyLink(7); //--></script>
          -------
        </span>
        


<pre id="comment_text_7">Sorry, I missed this when I was originally CC'd.  I'll get to it today.
</pre>
    </div>
  <div >
        <br>
        <span class="bz_comment">
          ------- <i>Comment
          <a name="c8" href="#c8">#8</a> From 
          <a href="mailto:eradicator&#64;gentoo.org">Jeremy Huddleston</a>
          2006-06-06 09:38 PST 
          </i>
          <script type="text/javascript"><!-- 
            addReplyLink(8); //--></script>
          -------
        </span>
        


<pre id="comment_text_8">Ok, all ready to commit... just waiting for the patch tarball to hit mirrors.
</pre>
    </div>
  <div >
        <br>
        <span class="bz_comment">
          ------- <i>Comment
          <a name="c9" href="#c9">#9</a> From 
          <a href="mailto:gentoo&#64;schirmeier.com">Horst Schirmeier</a>
          2006-06-06 09:53 PST 
          </i>
          <script type="text/javascript"><!-- 
            addReplyLink(9); //--></script>
          -------
        </span>
        


<pre id="comment_text_9">Thanks :) No offense, btw. (<a href="#c6">comment #6</a>). I just hadn't heard anything from
you...
</pre>
    </div>
  <div >
        <br>
        <span class="bz_comment">
          ------- <i>Comment
          <a name="c10" href="#c10">#10</a> From 
          <a href="mailto:eradicator&#64;gentoo.org">Jeremy Huddleston</a>
          2006-06-06 14:57 PST 
          </i>
          <script type="text/javascript"><!-- 
            addReplyLink(10); //--></script>
          -------
        </span>
        


<pre id="comment_text_10">No worries.  The tarball is on mirrors, and I've marked the ebuild is marked
stable on amd64 and sparc.
</pre>
    </div>
  <div >
        <br>
        <span class="bz_comment">
          ------- <i>Comment
          <a name="c11" href="#c11">#11</a> From 
          <a href="mailto:gentoo&#64;schirmeier.com">Horst Schirmeier</a>
          2006-06-06 15:30 PST 
          </i>
          <script type="text/javascript"><!-- 
            addReplyLink(11); //--></script>
          -------
        </span>
        


<pre id="comment_text_11">Works fine for me on ~x86. Non-{amd64,sparc} stable is still vulnerable,
though.
</pre>
    </div>
  <div >
        <br>
        <span class="bz_comment">
          ------- <i>Comment
          <a name="c12" href="#c12">#12</a> From 
          <a href="mailto:dercorny&#64;gentoo.org">Stefan Cornelius</a>
          2006-06-21 06:33 PST 
          </i>
          <script type="text/javascript"><!-- 
            addReplyLink(12); //--></script>
          -------
        </span>
        


<pre id="comment_text_12">Arches, please test 0.59s-r11 and mark stable if possible, thank you
</pre>
    </div>
  <div >
        <br>
        <span class="bz_comment">
          ------- <i>Comment
          <a name="c13" href="#c13">#13</a> From 
          <a href="mailto:dercorny&#64;gentoo.org">Stefan Cornelius</a>
          2006-06-21 06:33 PST 
          </i>
          <script type="text/javascript"><!-- 
            addReplyLink(13); //--></script>
          -------
        </span>
        


<pre id="comment_text_13">opening
</pre>
    </div>
  <div >
        <br>
        <span class="bz_comment">
          ------- <i>Comment
          <a name="c14" href="#c14">#14</a> From 
          <a href="mailto:corsair&#64;gentoo.org">Markus Rothe</a>
          2006-06-21 14:10 PST 
          </i>
          <script type="text/javascript"><!-- 
            addReplyLink(14); //--></script>
          -------
        </span>
        


<pre id="comment_text_14">stable on ppc64
</pre>
    </div>
  <div >
        <br>
        <span class="bz_comment">
          ------- <i>Comment
          <a name="c15" href="#c15">#15</a> From 
          <a href="mailto:tsunam&#64;gentoo.org">Joshua Jackson</a>
          2006-06-21 19:40 PST 
          </i>
          <script type="text/javascript"><!-- 
            addReplyLink(15); //--></script>
          -------
        </span>
        


<pre id="comment_text_15">x86 done ~_~
</pre>
    </div>
  <div >
        <br>
        <span class="bz_comment">
          ------- <i>Comment
          <a name="c16" href="#c16">#16</a> From 
          <a href="mailto:grobian&#64;gentoo.org">Fabian Groffen</a>
          2006-06-22 09:04 PST 
          </i>
          <script type="text/javascript"><!-- 
            addReplyLink(16); //--></script>
          -------
        </span>
        


<pre id="comment_text_16">ppc-macos done
</pre>
    </div>
  <div >
        <br>
        <span class="bz_comment">
          ------- <i>Comment
          <a name="c17" href="#c17">#17</a> From 
          <a href="mailto:tcort&#64;gentoo.org">Thomas Cort</a>
          2006-06-22 13:59 PST 
          </i>
          <script type="text/javascript"><!-- 
            addReplyLink(17); //--></script>
          -------
        </span>
        


<pre id="comment_text_17">alpha stable.
</pre>
    </div>
  <div >
        <br>
        <span class="bz_comment">
          ------- <i>Comment
          <a name="c18" href="#c18">#18</a> From 
          <a href="mailto:killerfox&#64;gentoo.org">René Nussbaumer</a>
          2006-06-24 10:57 PST 
          </i>
          <script type="text/javascript"><!-- 
            addReplyLink(18); //--></script>
          -------
        </span>
        


<pre id="comment_text_18">Stable on hppa
</pre>
    </div>
  <div >
        <br>
        <span class="bz_comment">
          ------- <i>Comment
          <a name="c19" href="#c19">#19</a> From 
          <a href="mailto:dertobi123&#64;gentoo.org">Tobias Scherbaum</a>
          2006-06-24 23:33 PST 
          </i>
          <script type="text/javascript"><!-- 
            addReplyLink(19); //--></script>
          -------
        </span>
        


<pre id="comment_text_19">ppc stable
</pre>
    </div>
  <div >
        <br>
        <span class="bz_comment">
          ------- <i>Comment
          <a name="c20" href="#c20">#20</a> From 
          <a href="mailto:jaervosz&#64;gentoo.org">Sune Kloppenborg Jeppesen</a>
          2006-07-03 11:35 PST 
          </i>
          <script type="text/javascript"><!-- 
            addReplyLink(20); //--></script>
          -------
        </span>
        


<pre id="comment_text_20">GLSA 200607-01

mips and ia64 don't forget to mark stable to benifit from the GLSA.
</pre>
    </div>

</form>

<hr>
<i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">No search results available</font></i>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="query.cgi">Search page</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="enter_bug.cgi">Enter new bug</a>

<br>
<div id="footer">
  <div class="intro"></div>




<form method="get" action="show_bug.cgi">
<p class="version"><a href="http://www.bugzilla.org/">Bugzilla</a> Version 2.20+<br>

<div id="useful-links">
  <div id="links-actions">
    <div class="label">Actions:</div>
    <div class="links">
        <a href="./">Home</a> | 
        <a href="enter_bug.cgi">New</a> | 
        <a href="query.cgi">Search</a> |
        bug # <input class="txt" name="id" size="6">
        <input class="btn" type="submit" value="Find"> | 
        
        <a href="report.cgi">Reports</a> 
        
          | <a href="request.cgi">Requests</a>
              
        
              | <a href="createaccount.cgi">New&nbsp;Account</a>
            | <a href="index.cgi?GoAheadAndLogIn=1">Log&nbsp;In</a>
    </div>
  </div>
      
    

    
    
  <div id="links-saved">
    <div class="label">
    </div>
    <div class="links">

    </div>
  </div>

  
</div>
</form>

  <div class="outro"></div>
</div>

</body>
</html>